# 
# Copyright (c) 2011-2012, John D. Blair <jdb@moship.net>
# All rights reserved.
# 
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions are met:
# 
# * Redistributions of source code must retain the above copyright
#   notice, this list of conditions and the following disclaimer.
# 
# * Redistributions in binary form must reproduce the above copyright
#   notice, this list of conditions and the following disclaimer in the
#   documentation and/or other materials provided with the distribution.
# 
# * Neither the name of John D. Blair nor his lackeys may be used
#   to endorse or promote products derived from this software
#   without specific prior written permission.
# 
# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
# "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
# LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
# FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL
# JOHN D. BLAIR BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
# SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
# LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
# USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
# ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
# OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
# OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
# SUCH DAMAGE.



#
# Panel Module (Floating Point)
#
model suns {
  did 501 "panel_module_float"
  datapoints {
    Stat                { enum16.Stat_enum req label="Module Status Code" }
    StatVend            { enum16 label="Module Vendor Status Code" }
    Evt                 { bitfield32.Evt_bf req label="Module Event Flags" }
    EvtVend             { bitfield32 label="Vendor Module Event Flags" }
    Ctl                 { enum16 access=rw label="Module Control" }
    CtlVend             { enum32 access=rw label="Vendor Module Control" }
    CtlVal              { int32 access=rw label="Module Control Value" }
    Tms                 { uint32  u=Tms1970 label="Timestamp" }
    OutA                { float32 u=A label="Output Current" }
    OutV                { float32 u=V label="Output Voltage" }
    OutWh               { float32 u=Wh label="Output Energy" }
    OutPwr              { float32 u=W label="Output Power" }
    Tmp                 { float32 u=C label="Module Temperature" }
    InA                 { float32 u=A label="Input Current" }
    InV                 { float32 u=V label="Input Voltage" }
    InWh                { float32 u=Wh label="Input Energy" }
    InPwr               { float32 u=W label="Input Power" }
  }

  define Stat_enum {
    P_STATUS_OFF              {  1 "Off" }
    P_STATUS_SLEEPING         {  2 "Sleeping (auto-shutdown) or panel is at low/safe output power/voltage" }
    P_STATUS_STARTING         {  3 "Starting up or ON but not producting power; panel might have high voltage but is not producing power" }
    P_STATUS_MPPT             {  4 "Tracking MPPT power point" }
    P_STATUS_THROTTLED        {  5 "Forced power reduction / power de-rating" }
    P_STATUS_SHUTTING_DOWN    {  6 "Shutting down" }
    P_STATUS_FAULT            {  7 "One or more faults exist" }
    P_STATUS_STANDBY          {  8 "Standby (service or unit) - unlike SLEEPING in this mode the module might be at a high (unsafe) output voltage or power" }
    P_STATUS_TEST             {  9 "Test mode" }
    P_STATUS_OTHER            { 10 "As defined in vendor specific status" }
  }

  define Evt_bf {
    P_EVENT_GROUND_FAULT      { 1 "Ground Fault" }
    P_EVENT_INPUT_OVER_VOLTAGE  { 2 "DC input over-voltage" }
    RESERVED                  { 3 "Reserved for u-inverter compatibility" }
    P_EVENT_DC_DISCONNECT     { 4 "DC disconnect open" }
    RESERVED                  { 5 "Reserved for u-inverter compatibility" }
    RESERVED                  { 6 "Reserved for u-inverter compatibility" }
    P_EVENT_MANUAL_SHUTDOWN   { 7 "Manual shutdown" }
    P_EVENT_OVER_TEMPERATURE  { 8 "Over Temperature" }
    RESERVED                  { 9 "Reserved for u-inverter compatibility" }
    RESERVED                  { 10 "Reserved for u-inverter compatibility" }
    RESERVED                  { 11 "Reserved for u-inverter compatibility" }
    RESERVED                  { 12 "Reserved for u-inverter compatibility" }
    P_EVENT_BLOWN_FUSE        { 13 "Blown Input Fuse" }
    P_EVENT_UNDER_TEMPERATURE { 14 "Under Temperature" }
    P_EVENT_MEMORY_LOSS       { 15 "Generic Memory or Communication Error." }
    P_EVENT_ARC_DETECTION     { 16 "Arc Detection" }
    P_EVENT_THEFT_DETECTION   { 17 "Theft Detection" }
    P_EVENT_OUTPUT_OVER_CURRENT { 18 "Output Over Current" }
    P_EVENT_OUTPUT_OVER_VOLTAGE { 19 "DC Output Over Voltage" }
    P_EVENT_OUTPUT_UNDER_VOLTAGE { 20 "DC Output Under Voltage" }
    P_EVENT_TEST_FAILED       { 21 "Last Self Test failed; see vendor event for details." }
  }
}

#
# Panel Module (Integer)
#
model suns {
  did 502 "panel_module_integer"
  datapoints {
    A_SF               { sunssf }
    V_SF               { sunssf }
    Pwr_SF             { sunssf }
    Wh_SF              { sunssf }
    Stat               { enum16 req label="Module Status Code" }
    StatVend           { enum16 label="Vendor Module Status Code" }
    Evt                { bitfield32 req label="Module Event Flags" }
    EvtVend            { bitfield32 label="Vendor Module Event Flags" }
    Ctl                { enum16 access="rw" label="Module Control" }
    CtlVend            { enum32 access="rw" label="Vendor Module Control" }
    CtlVal             { int32 access="rw" label="Module Control Value" }
    Tms                { uint32 u=Tms label="Timestamp" }
    OutA               { int16.A_SF u=A label="Output Current" }
    OutV               { int16.V_SF u=V label="Output Voltage" }
    OutWh              { acc32.Wh_SF u=Wh label="Output Energy" }
    OutPw              { int16.Pwr_SF u=W label="Output Power" }
    Tmp                { int16 u=C label="Module Temperature" }
    InA                { int16.A_SF u=A label="Input Current" }
    InV                { int16.V_SF u=V label="Input Voltage" }
    InWh               { acc32.Wh_SF u=Wh label="Input Energy" }
    InPwr              { int16.Pwr_SF u=W label="Input Power" }
  }
      
  define Stat {
    P_STATUS_OFF              {  1 "Off" }
    P_STATUS_SLEEPING         {  2 "Sleeping (auto-shutdown) or panel is at low/safe output power/voltage" }
    P_STATUS_STARTING         {  3 "Starting up or ON but not producting power; panel might have high voltage but is not producing power" }
    P_STATUS_MPPT             {  4 "Tracking MPPT power point" }
    P_STATUS_THROTTLED        {  5 "Forced power reduction / power de-rating" }
    P_STATUS_SHUTTING_DOWN    {  6 "Shutting down" }
    P_STATUS_FAULT            {  7 "One or more faults exist" }
    P_STATUS_STANDBY          {  8 "Standby (service or unit) - unlike SLEEPING in this mode the module might be at a high (unsafe) output voltage or power" }
    P_STATUS_TEST             {  9 "Test mode" }
    P_STATUS_OTHER            { 10 "As defined in vendor specific status" }
  }

  define Evt {
    P_EVENT_GROUND_FAULT      { 1 "Ground Fault" }
    P_EVENT_INPUT_OVER_VOLTAGE  { 2 "DC input over-voltage" }
    RESERVED                  { 3 "Reserved for u-inverter compatibility" }
    P_EVENT_DC_DISCONNECT     { 4 "DC disconnect open" }
    RESERVED                  { 5 "Reserved for u-inverter compatibility" }
    RESERVED                  { 6 "Reserved for u-inverter compatibility" }
    P_EVENT_MANUAL_SHUTDOWN   { 7 "Manual shutdown" }
    P_EVENT_OVER_TEMPERATURE  { 8 "Over Temperature" }
    RESERVED                  { 9 "Reserved for u-inverter compatibility" }
    RESERVED                  { 10 "Reserved for u-inverter compatibility" }
    RESERVED                  { 11 "Reserved for u-inverter compatibility" }
    RESERVED                  { 12 "Reserved for u-inverter compatibility" }
    P_EVENT_BLOWN_FUSE        { 13 "Blown Input Fuse" }
    P_EVENT_UNDER_TEMPERATURE { 14 "Under Temperature" }
    P_EVENT_MEMORY_LOSS       { 15 "Generic Memory or Communication Error." }
    P_EVENT_ARC_DETECTION     { 16 "Arc Detection" }
    P_EVENT_THEFT_DETECTION   { 17 "Theft Detection" }
    P_EVENT_OUTPUT_OVER_CURRENT { 18 "Output Over Current" }
    P_EVENT_OUTPUT_OVER_VOLTAGE { 19 "DC Output Over Voltage" }
    P_EVENT_OUTPUT_UNDER_VOLTAGE { 20 "DC Output Under Voltage" }
    P_EVENT_TEST_FAILED       { 21 "Last Self Test failed; see vendor event for details." }
  }
}

